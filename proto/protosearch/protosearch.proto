syntax = "proto2";

package protosearch;

import "google/protobuf/descriptor.proto";
import "google/protobuf/struct.proto";

extend google.protobuf.FieldOptions {
  optional Mapping mapping = 50000;
}

enum Dynamic {
  DYNAMIC_UNSPECIFIED = 0;
  DYNAMIC_TRUE = 1;
  DYNAMIC_FALSE = 2;
  DYNAMIC_STRICT = 3;
  DYNAMIC_RUNTIME = 4;
}

enum IndexOptions {
  INDEX_OPTIONS_UNSPECIFIED = 0;
  INDEX_OPTIONS_DOCS = 1;
  INDEX_OPTIONS_FREQS = 2;
  INDEX_OPTIONS_POSITIONS = 3;
  INDEX_OPTIONS_OFFSETS = 4;
}

enum TermVector {
  TERM_VECTOR_UNSPECIFIED = 0;
  TERM_VECTOR_NO = 1;
  TERM_VECTOR_YES = 2;
  TERM_VECTOR_WITH_POSITIONS = 3;
  TERM_VECTOR_WITH_OFFSETS = 4;
  TERM_VECTOR_WITH_POSITIONS_OFFSETS = 5;
  TERM_VECTOR_WITH_POSITIONS_PAYLOADS = 6;
  TERM_VECTOR_WITH_POSITIONS_OFFSETS_PAYLOADS = 7;
}

message Mapping {
  // Rename this field in the mapping.
  optional string name = 1 [targets = TARGET_TYPE_FIELD];

  // Configure a literal mapping for a specific target.
  //
  // This does not target a specific type because it will apply to complete
  // mappings as well.
  repeated Target target = 2;

  // Field options.
  optional FieldMapping field = 3 [targets = TARGET_TYPE_FIELD];

  // Reserved for document options.
  optional DocumentMapping doc = 4 [targets = TARGET_TYPE_MESSAGE];

  // Reserved for future use.
  extensions 1000 to max;
}

message DocumentMapping {}

/**
 * FieldMapping represents common mapping parameters.
 *
 * These mapping parameters are common to some or all types.
 *
 *    https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/mapping-parameters
 *    https://docs.opensearch.org/latest/mappings/mapping-parameters/index/
 *
 * This is the union of common parameters for both vendors.
 *
 * Some of these parameters are specific to certain types. However they are
 * common enough to warrant convenient top-level fields.
 *
 * We deliberately omit the `properties` field because we represent `object` and
 * `nested` fields as messages.
 */
message FieldMapping {
  // The field type.
  // If omitted, the plugin infers the type from the protobuf field type.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/type
  optional string type = 1;

  // Analyzer used at index time. Applies to `text` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/analyzer
  optional string analyzer = 2;

  // Boost a field's score at index time.
  //
  // Elasticsearch: 7.x and earlier
  // OpenSearch: all
  //
  // https://docs.opensearch.org/latest/mappings/mapping-parameters/boost/
  optional double boost = 26;

  // Whether to coerce values to the declared mapping type. Applies to numeric
  // and date fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/coerce
  optional bool coerce = 3;

  // Copy this field's value to the named field.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/copy-to
  repeated string copy_to = 4;

  // Whether to store doc values for sorting and aggregation.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/doc-values
  optional bool doc_values = 5;

  // How to handle unknown subfields. Applies to `object` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/dynamic
  optional Dynamic dynamic = 6;

  // Whether to load global ordinals at refresh time.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/eager-global-ordinals
  optional bool eager_global_ordinals = 7;

  // Whether to parse and index the field.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/enabled
  optional bool enabled = 8;

  // Fielddata configuration for in-memory aggregations. Applies to `text` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/fielddata
  optional bool fielddata = 9;

  // A multi-field mapping.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/fields
  map<string, FieldMapping> fields = 10;

  // The date format. Applies to `date` and `date_nanos` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/format
  optional string format = 11;

  // Do not index strings longer than this length. Applies to `keyword` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/ignore-above
  optional int32 ignore_above = 12;

  // Ignore invalid values instead of rejecting the document.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/ignore-malformed
  optional bool ignore_malformed = 13;

  // Which information to store in the index. Applies to `text` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/index-options
  optional IndexOptions index_options = 14;

  // Whether to index bigrams separately.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/index-phrases
  optional bool index_phrases = 27;

  // Index term prefixes.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/index-prefixes
  optional IndexPrefixes index_prefixes = 28;

  // Whether to index the field.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/index
  optional bool index = 15;

  // Metadata about the field.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/meta
  map<string, string> meta = 16;

  // Normalize `keyword` fields with this normalizer.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/normalizer
  optional string normalizer = 17;

  // Whether to store field length norms for scoring.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/norms
  optional bool norms = 18;

  // Replace explicit `null` values with this value at index time.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/null-value
  optional google.protobuf.Value null_value = 19;

  // A gap inserted between elements in an array to prevent spurious matches.
  // Applies to `text` fields.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/position-increment-gap
  optional int32 position_increment_gap = 20;

  // properties

  // Analyzer used at search time.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/search-analyzer
  optional string search_analyzer = 21;

  // The scoring algorithm.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/similarity
  optional string similarity = 22;

  // Whether to store this field separately from `_source`.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/store
  optional bool store = 23;

  // Whether dotted field names are interpreted as nested subobjects.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/subobjects
  optional bool subobjects = 24;

  // Whether to store term vectors.
  // https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/term-vector
  optional TermVector term_vector = 25;
}

message IndexPrefixes {
  // Minimum prefix length to index.
  optional int32 min_chars = 1;

  // Maximum prefix length to index.
  optional int32 max_chars = 2;
}

/**
 * A labelled, literal field mapping.
 */
message Target {
  // The label that identifies this target.
  optional string label = 1;

  // The literal mapping JSON.
  optional string json = 2;
}
