syntax = "proto3";

package tests;

import "protosearch/protosearch.proto";

message FieldTestCase {
  string basic = 1 [(protosearch.field).mapping = {
    type: "text"
    analyzer: "english"
    boost: 3.14
    coerce: true
    copy_to: "copy_field"
    doc_values: true
    dynamic: DYNAMIC_STRICT
    eager_global_ordinals: true
    enabled: true
    fielddata: true
    fields: {
      key: "raw"
      value: {type: "keyword"}
    }
    format: "yyyy-MM-dd"
    ignore_above: 256
    ignore_malformed: false
    index_options: INDEX_OPTIONS_POSITIONS
    index_phrases: true
    index_prefixes: {
      min_chars: 5
      max_chars: 15
    }
    index: true
    meta: {
      key: "unit"
      value: "ms"
    }
    normalizer: "lowercase"
    norms: true
    null_value: {string_value: "NULL"}
    position_increment_gap: 100
    search_analyzer: "english"
    similarity: "BM25"
    subobjects: false
    store: true
    term_vector: TERM_VECTOR_WITH_POSITIONS
  }];

  string output_name = 2 [(protosearch.field).name = "foo"];

  string output_target = 3 [(protosearch.field).target = {
    label: "foo"
    json: '{"type": "keyword"}'
  }];
}

message IndexTestCase {
  option (protosearch.index) = {
    date_detection: false
    dynamic: DYNAMIC_STRICT
    dynamic_date_formats: "strict_date_optional_time"
    dynamic_date_formats: "epoch_millis"
    _field_names: {enabled: false}
    _meta: {
      key: "created_by"
      value: "protosearch"
    }
    numeric_detection: true
    _routing: {required: true}
    _source: {
      compress: true
      compress_threshold: "512kb"
      enabled: true
      excludes: "secret_field"
      includes: "title"
      mode: SOURCE_MODE_STORED
    }
  };

  string title = 1 [(protosearch.field).mapping.type = "text"];
  string uid = 2 [(protosearch.field) = {}];
}

message InferTypeTestCase {
  message Message {}

  enum Enum {
    ENUM_UNSPECIFIED = 0;
  }

  string keyword_string = 1 [(protosearch.field) = {}];
  Enum keyword_enum = 2 [(protosearch.field) = {}];
  bool boolean = 3 [(protosearch.field) = {}];
  int32 integer_int32 = 4 [(protosearch.field) = {}];
  sint32 integer_sint32 = 5 [(protosearch.field) = {}];
  sfixed32 integer_sfixed32 = 6 [(protosearch.field) = {}];
  uint32 long_uint32 = 7 [(protosearch.field) = {}];
  fixed32 long_fixed32 = 8 [(protosearch.field) = {}];
  int64 long_int64 = 9 [(protosearch.field) = {}];
  sint64 long_sint64 = 10 [(protosearch.field) = {}];
  sfixed64 long_sfixed64 = 11 [(protosearch.field) = {}];
  uint64 unsigned_long_uint64 = 12 [(protosearch.field) = {}];
  fixed64 unsigned_long_fixed64 = 13 [(protosearch.field) = {}];
  float float = 14 [(protosearch.field) = {}];
  double double = 15 [(protosearch.field) = {}];
  bytes binary = 16 [(protosearch.field) = {}];
  Message object = 17 [(protosearch.field) = {}];
}

message DynamicTestCase {
  string unspecified = 1 [(protosearch.field).mapping.dynamic = DYNAMIC_UNSPECIFIED];
  string true = 2 [(protosearch.field).mapping.dynamic = DYNAMIC_TRUE];
  string false = 3 [(protosearch.field).mapping.dynamic = DYNAMIC_FALSE];
  string strict = 4 [(protosearch.field).mapping.dynamic = DYNAMIC_STRICT];
  string runtime = 5 [(protosearch.field).mapping.dynamic = DYNAMIC_RUNTIME];
}

message TermVectorTestCase {
  string unspecified = 1 [(protosearch.field).mapping.term_vector = TERM_VECTOR_UNSPECIFIED];
  string no = 2 [(protosearch.field).mapping.term_vector = TERM_VECTOR_NO];
  string yes = 3 [(protosearch.field).mapping.term_vector = TERM_VECTOR_YES];
  string with_positions = 4 [(protosearch.field).mapping.term_vector = TERM_VECTOR_WITH_POSITIONS];
  string with_offsets = 5 [(protosearch.field).mapping.term_vector = TERM_VECTOR_WITH_OFFSETS];
  string with_positions_offsets = 6 [(protosearch.field).mapping.term_vector = TERM_VECTOR_WITH_POSITIONS_OFFSETS];
  string with_positions_payloads = 7 [(protosearch.field).mapping.term_vector = TERM_VECTOR_WITH_POSITIONS_PAYLOADS];
  string with_positions_offsets_payloads = 8 [(protosearch.field).mapping.term_vector = TERM_VECTOR_WITH_POSITIONS_OFFSETS_PAYLOADS];
}

message IndexOptionsTestCase {
  string unspecified = 1 [(protosearch.field).mapping.index_options = INDEX_OPTIONS_UNSPECIFIED];
  string docs = 2 [(protosearch.field).mapping.index_options = INDEX_OPTIONS_DOCS];
  string freqs = 3 [(protosearch.field).mapping.index_options = INDEX_OPTIONS_FREQS];
  string positions = 4 [(protosearch.field).mapping.index_options = INDEX_OPTIONS_POSITIONS];
  string offsets = 5 [(protosearch.field).mapping.index_options = INDEX_OPTIONS_OFFSETS];
}

message InvalidTargetJsonTestCase {
  string invalid_json = 1 [(protosearch.field) = {
    target: {
      label: "invalid-json-string"
      json: "foo"
    }
    target: {
      label: "invalid-json-array"
      json: "[1, 2, 3]"
    }
  }];
}

message InvalidFieldNameTestCase {
  string lowercase = 1 [(protosearch.field).name = "valid"];
  string with_underscore = 2 [(protosearch.field).name = "valid_name"];
  string with_digit = 3 [(protosearch.field).name = "field1"];
  string at_prefix = 4 [(protosearch.field).name = "@timestamp"];
  string dotted = 5 [(protosearch.field).name = "object.field"];

  string empty = 100 [(protosearch.field).name = ""];
  string uppercase = 101 [(protosearch.field).name = "Title"];
  string leading_digit = 102 [(protosearch.field).name = "1field"];
  string hyphen = 103 [(protosearch.field).name = "field-name"];
}

message IgnoreAboveTestCase {
  string valid = 1 [(protosearch.field).mapping = {
    type: "keyword"
    ignore_above: 256
  }];
  string zero = 2 [(protosearch.field).mapping = {
    type: "keyword"
    ignore_above: 0
  }];
  string negative = 3 [(protosearch.field).mapping = {
    type: "keyword"
    ignore_above: -1
  }];
}

message PositionIncrementGapTestCase {
  string zero = 1 [(protosearch.field).mapping = {
    type: "text"
    position_increment_gap: 0
  }];
  string valid = 2 [(protosearch.field).mapping = {
    type: "text"
    position_increment_gap: 100
  }];
  string negative = 3 [(protosearch.field).mapping = {
    type: "text"
    position_increment_gap: -1
  }];
}

message IndexPrefixesTestCase {
  string valid = 1 [(protosearch.field).mapping = {
    type: "text"
    index_prefixes: {
      min_chars: 1
      max_chars: 10
    }
  }];
  string min_chars_negative = 2 [(protosearch.field).mapping = {
    type: "text"
    index_prefixes: {
      min_chars: -1
      max_chars: 10
    }
  }];
  string max_chars_negative = 3 [(protosearch.field).mapping = {
    type: "text"
    index_prefixes: {
      min_chars: 1
      max_chars: -1
    }
  }];
}

message EnumTestCase {
  enum Enum {
    ENUM_UNSPECIFIED = 0;
    ENUM_ACTIVE = 1;
  }

  Enum status_inferred = 1 [(protosearch.field).mapping = {}];
  Enum status_keyword = 2 [(protosearch.field).mapping.type = "keyword"];
  Enum status_integer = 3 [(protosearch.field).mapping.type = "integer"];
}

message NestedValidationTestCase {
  message Inner {
    string bad_field = 1 [(protosearch.field).name = "BadField"];
  }
  Inner inner = 1 [(protosearch.field).mapping = {}];
}

message MessageTestCase {
  message Message {
    string uid = 1 [(protosearch.field).mapping = {}];
  }

  Message message_object_singular = 1 [(protosearch.field).mapping = {type: "object"}];
  Message message_nested_singular = 2 [(protosearch.field).mapping = {type: "nested"}];
  repeated Message message_object_repeated = 3 [(protosearch.field).mapping = {type: "object"}];
  repeated Message message_nested_repeated = 4 [(protosearch.field).mapping = {type: "nested"}];
  Message message_object_with_parameters = 5 [(protosearch.field).mapping = {
    type: "object"
    dynamic: DYNAMIC_STRICT
  }];
  Message message_nested_with_parameters = 6 [(protosearch.field).mapping = {
    type: "nested"
    dynamic: DYNAMIC_STRICT
  }];
}
