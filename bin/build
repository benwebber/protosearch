#!/usr/bin/env bash
set -euo pipefail

TARGET=$1
REF=${2:-dev}
VERSION=${REF#refs/tags/}

BINARY="protoc-gen-protosearch"

cargo build --release --target "$TARGET"

tar czf "${BINARY}-${VERSION}-${TARGET}.tar.gz" \
    -C "target/$TARGET/release" "$BINARY"
